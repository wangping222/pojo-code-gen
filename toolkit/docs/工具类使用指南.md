# 工具类使用指南

## 📋 概述

本文档详细介绍toolkit模块中各种工具类的使用方法、设计原理和最佳实践。这些工具类是企业应用开发中经过生产验证的常用组件。

## 🛠️ 已实现工具类

### 1. 异常处理工具

#### Assert 断言工具类
提供断言风格的验证方法，简化参数和业务规则验证。

```java
// 基础断言
Assert.notNull(user, "用户对象不能为空");
Assert.notBlank(username, "用户名不能为空");
Assert.notEmpty(list, "列表不能为空");

// 数值断言
Assert.isTrue(age > 0, "年龄必须大于0");
Assert.isFalse(username.contains("admin"), "用户名不能包含admin");

// 业务规则断言
Assert.state(user.isActive(), "用户状态必须为激活");
Assert.expression(user.getAge() >= 18, "用户年龄必须大于等于18岁");
```

#### ExceptionUtils 异常工具类
提供便捷的异常创建和抛出方法。

```java
// 快速抛出异常
ExceptionUtils.throwBusiness(I18nCommonExceptionCode.DATA_NOT_FOUND);
ExceptionUtils.throwSystem(I18nCommonExceptionCode.DATABASE_ERROR);

// 条件异常
ExceptionUtils.throwBusinessIf(user == null, I18nCommonExceptionCode.USER_NOT_FOUND);
ExceptionUtils.throwSystemIf(connection == null, I18nCommonExceptionCode.CONNECTION_FAILED);

// 参数验证
ExceptionUtils.requireNonNull(request, "request");
ExceptionUtils.requireNonBlank(username, "username");
ExceptionUtils.requireTrue(isValid, I18nCommonExceptionCode.PARAM_INVALID);

// 创建异常（不抛出）
BusinessException exception = ExceptionUtils.business(errorCode);
SystemException sysException = ExceptionUtils.system(errorCode, cause);
```

### 2. 响应处理工具

#### Response 统一响应类
提供标准化的API响应格式。

```java
// 成功响应
Response<User> response = Response.success(user);
Response<List<User>> listResponse = Response.success(userList);
Response<Void> voidResponse = Response.success();

// 失败响应
Response<Void> errorResponse = Response.error(errorCode, message);
Response<Void> businessError = Response.businessError(I18nCommonExceptionCode.USER_NOT_FOUND);
Response<Void> systemError = Response.systemError(I18nCommonExceptionCode.DATABASE_ERROR);

// 响应格式
{
  "code": 0,          // 0表示成功，其他表示错误码
  "message": "操作成功", // 响应消息
  "data": {...}       // 响应数据
}
```

### 3. 分页查询工具

#### Pagination 分页结果类
标准化的分页响应格式。

```java
// 创建分页结果
List<User> users = userService.queryUsers(query);
long total = userService.countUsers(query);
Pagination<User> pagination = Pagination.of(users, total, query.getPageNum(), query.getPageSize());

// 分页响应格式
{
  "records": [...],     // 数据列表
  "total": 100,         // 总记录数
  "pageNum": 1,         // 当前页码
  "pageSize": 10,       // 每页大小
  "pages": 10,          // 总页数
  "hasNext": true,      // 是否有下一页
  "hasPrevious": false  // 是否有上一页
}
```

#### AbstractPageQuery 抽象分页查询类
提供标准的分页查询基类。

```java
public class UserQuery extends AbstractPageQuery {
    private String username;
    private String email;
    private QueryType status;
    
    // getter/setter...
}

// 使用示例
UserQuery query = new UserQuery();
query.setPageNum(1);
query.setPageSize(10);
query.setUsername("admin");

// 自动处理分页参数
if (query.getPageNum() == null) {
    query.setPageNum(1);
}
if (query.getPageSize() == null) {
    query.setPageSize(10);
}
```

### 4. 查询条件工具

#### QueryWrapperHelper 查询包装器助手
简化MyBatis查询条件构建。

```java
QueryWrapper<User> wrapper = QueryWrapperHelper.buildWrapper(query);
// 自动根据query对象构建查询条件

// 自定义查询条件
QueryWrapper<User> customWrapper = new QueryWrapper<>();
QueryWrapperHelper.addCondition(customWrapper, "username", query.getUsername());
QueryWrapperHelper.addLikeCondition(customWrapper, "email", query.getEmail());
QueryWrapperHelper.addInCondition(customWrapper, "status", query.getStatusList());
```

## 🚀 计划实现的工具类

### 1. 日期时间工具 (DateTimeUtils)

```java
// 日期格式化
String formatted = DateTimeUtils.format(LocalDateTime.now(), "yyyy-MM-dd HH:mm:ss");
String isoString = DateTimeUtils.toIsoString(LocalDateTime.now());

// 日期解析
LocalDateTime dateTime = DateTimeUtils.parse("2023-12-01 10:30:00", "yyyy-MM-dd HH:mm:ss");
LocalDate date = DateTimeUtils.parseDate("2023-12-01");

// 日期计算
LocalDateTime tomorrow = DateTimeUtils.addDays(LocalDateTime.now(), 1);
LocalDateTime nextWeek = DateTimeUtils.addWeeks(LocalDateTime.now(), 1);
long daysBetween = DateTimeUtils.daysBetween(startDate, endDate);

// 时区转换
ZonedDateTime utc = DateTimeUtils.toUTC(LocalDateTime.now());
LocalDateTime local = DateTimeUtils.toLocal(utcDateTime, ZoneId.of("Asia/Shanghai"));

// 业务日期判断
boolean isWorkday = DateTimeUtils.isWorkday(LocalDate.now());
boolean isWeekend = DateTimeUtils.isWeekend(LocalDate.now());
LocalDate nextWorkday = DateTimeUtils.nextWorkday(LocalDate.now());
```

### 2. 字符串处理工具 (StringUtils)

```java
// 字符串验证
boolean isEmpty = StringUtils.isEmpty(str);
boolean isBlank = StringUtils.isBlank(str);
boolean hasText = StringUtils.hasText(str);

// 字符串转换
String camelCase = StringUtils.toCamelCase("user_name");        // userName
String snakeCase = StringUtils.toSnakeCase("userName");         // user_name
String kebabCase = StringUtils.toKebabCase("userName");         // user-name
String pascalCase = StringUtils.toPascalCase("user_name");      // UserName

// 字符串处理
String truncated = StringUtils.truncate(longText, 100);
String masked = StringUtils.mask("18888888888", 3, 4, '*');     // 188****8888
String padded = StringUtils.padLeft("123", 6, '0');            // 000123

// 字符串安全
String escaped = StringUtils.escapeHtml(htmlContent);
String unescaped = StringUtils.unescapeHtml(escapedContent);
boolean isSafe = StringUtils.isSqlSafe(input);

// 中文处理
boolean isChinese = StringUtils.isChinese(text);
int chineseLength = StringUtils.getChineseLength(text);
String pinyin = StringUtils.toPinyin("中国");                   // zhongguo
```

### 3. 集合操作工具 (CollectionUtils)

```java
// 集合验证
boolean isEmpty = CollectionUtils.isEmpty(list);
boolean isNotEmpty = CollectionUtils.isNotEmpty(list);

// 集合转换
List<String> names = CollectionUtils.map(users, User::getName);
Map<Long, User> userMap = CollectionUtils.toMap(users, User::getId);
List<Long> ids = CollectionUtils.extractProperty(users, "id", Long.class);

// 集合过滤
List<User> activeUsers = CollectionUtils.filter(users, User::isActive);
List<User> adults = CollectionUtils.filter(users, user -> user.getAge() >= 18);

// 集合分组
Map<String, List<User>> groupByCity = CollectionUtils.groupBy(users, User::getCity);
Map<Boolean, List<User>> partitioned = CollectionUtils.partition(users, User::isActive);

// 集合运算
List<User> intersection = CollectionUtils.intersection(list1, list2);
List<User> union = CollectionUtils.union(list1, list2);
List<User> difference = CollectionUtils.difference(list1, list2);

// 分页处理
List<User> page = CollectionUtils.page(users, 1, 10);
List<List<User>> batches = CollectionUtils.batch(users, 100);
```

### 4. JSON处理工具 (JsonUtils)

```java
// 对象转JSON
String json = JsonUtils.toJson(user);
String prettyJson = JsonUtils.toPrettyJson(user);

// JSON转对象
User user = JsonUtils.fromJson(json, User.class);
List<User> users = JsonUtils.fromJsonList(json, User.class);
Map<String, Object> map = JsonUtils.fromJsonMap(json);

// 类型安全转换
Optional<User> userOpt = JsonUtils.tryFromJson(json, User.class);
List<User> safeUsers = JsonUtils.fromJsonListSafe(json, User.class);

// JSON操作
boolean isValidJson = JsonUtils.isValidJson(json);
Object value = JsonUtils.getValue(json, "user.name");
String updatedJson = JsonUtils.setValue(json, "user.age", 25);

// 配置选项
JsonUtils.configure(config -> {
    config.setDateFormat("yyyy-MM-dd HH:mm:ss");
    config.setIgnoreNullValues(true);
    config.setIgnoreUnknownProperties(true);
});
```

### 5. 文件操作工具 (FileUtils)

```java
// 文件读写
String content = FileUtils.readString(path);
byte[] bytes = FileUtils.readBytes(path);
List<String> lines = FileUtils.readLines(path);

FileUtils.writeString(path, content);
FileUtils.writeBytes(path, bytes);
FileUtils.writeLines(path, lines);

// 文件信息
boolean exists = FileUtils.exists(path);
long size = FileUtils.size(path);
String extension = FileUtils.getExtension(path);
String mimeType = FileUtils.getMimeType(path);

// 文件操作
boolean copied = FileUtils.copy(sourcePath, targetPath);
boolean moved = FileUtils.move(sourcePath, targetPath);
boolean deleted = FileUtils.delete(path);

// 目录操作
boolean created = FileUtils.createDirectories(dirPath);
List<Path> files = FileUtils.listFiles(dirPath);
List<Path> filtered = FileUtils.listFiles(dirPath, "*.java");

// 文件上传处理
boolean isValidImage = FileUtils.isValidImageFile(multipartFile);
String savedPath = FileUtils.saveUploadFile(multipartFile, uploadDir);
BufferedImage resized = FileUtils.resizeImage(imagePath, 800, 600);
```

### 6. 网络请求工具 (HttpUtils)

```java
// GET 请求
String response = HttpUtils.get("https://api.example.com/users");
User user = HttpUtils.get("https://api.example.com/users/1", User.class);

// POST 请求
String result = HttpUtils.post("https://api.example.com/users", userJson);
User created = HttpUtils.post("https://api.example.com/users", createRequest, User.class);

// 带参数请求
Map<String, String> params = Map.of("page", "1", "size", "10");
String response = HttpUtils.get("https://api.example.com/users", params);

// 带头部请求
Map<String, String> headers = Map.of("Authorization", "Bearer " + token);
String response = HttpUtils.get("https://api.example.com/users", params, headers);

// 文件上传
String result = HttpUtils.uploadFile("https://api.example.com/upload", file);

// 异步请求
CompletableFuture<String> future = HttpUtils.getAsync("https://api.example.com/users");
```

### 7. 加密工具 (CryptoUtils)

```java
// MD5 和 SHA
String md5 = CryptoUtils.md5(text);
String sha256 = CryptoUtils.sha256(text);
String sha512 = CryptoUtils.sha512(text);

// Base64 编码
String encoded = CryptoUtils.base64Encode(data);
byte[] decoded = CryptoUtils.base64Decode(encoded);

// AES 加密
String encrypted = CryptoUtils.aesEncrypt(plaintext, key);
String decrypted = CryptoUtils.aesDecrypt(encrypted, key);

// RSA 加密
KeyPair keyPair = CryptoUtils.generateRSAKeyPair();
String encrypted = CryptoUtils.rsaEncrypt(plaintext, keyPair.getPublic());
String decrypted = CryptoUtils.rsaDecrypt(encrypted, keyPair.getPrivate());

// 密码处理
String hashed = CryptoUtils.hashPassword(password);
boolean matches = CryptoUtils.checkPassword(password, hashed);

// 随机生成
String randomString = CryptoUtils.randomString(16);
String uuid = CryptoUtils.randomUUID();
byte[] salt = CryptoUtils.generateSalt();
```

### 8. 数据验证工具 (ValidationUtils)

```java
// 基础验证
boolean isEmail = ValidationUtils.isEmail("user@example.com");
boolean isMobile = ValidationUtils.isMobile("18888888888");
boolean isIdCard = ValidationUtils.isIdCard("110101199001011234");

// 正则验证
boolean matches = ValidationUtils.matches(text, pattern);
boolean isAlphanumeric = ValidationUtils.isAlphanumeric(text);
boolean isNumeric = ValidationUtils.isNumeric(text);

// 业务验证
boolean isValidPassword = ValidationUtils.isStrongPassword(password);
boolean isValidUsername = ValidationUtils.isValidUsername(username);
boolean isValidUrl = ValidationUtils.isUrl(url);

// 银行卡验证
boolean isValidBankCard = ValidationUtils.isBankCard("6222000000000000");
boolean isValidCreditCard = ValidationUtils.isCreditCard("4111111111111111");

// 自定义验证器
ValidationUtils.addValidator("custom", text -> text.startsWith("CUSTOM_"));
boolean isValid = ValidationUtils.validate("CUSTOM_123", "custom");
```

## 📖 使用最佳实践

### 1. 异常处理最佳实践

```java
@Service
public class UserService {
    
    public User createUser(CreateUserRequest request) {
        // 1. 参数验证
        ExceptionUtils.requireNonNull(request, "创建用户请求不能为空");
        ExceptionUtils.requireNonBlank(request.getUsername(), "用户名不能为空");
        ExceptionUtils.requireNonBlank(request.getEmail(), "邮箱不能为空");
        
        // 2. 业务规则验证
        ExceptionUtils.requireTrue(ValidationUtils.isEmail(request.getEmail()), 
                                  I18nCommonExceptionCode.EMAIL_INVALID);
        ExceptionUtils.throwBusinessIf(userRepository.existsByUsername(request.getUsername()),
                                      I18nCommonExceptionCode.USER_ALREADY_EXISTS);
        
        // 3. 业务逻辑处理
        try {
            User user = new User();
            // ... 设置用户属性
            return userRepository.save(user);
        } catch (DataAccessException e) {
            // 4. 系统异常转换
            throw ExceptionUtils.system(I18nCommonExceptionCode.DATABASE_ERROR, e);
        }
    }
}
```

### 2. 分页查询最佳实践

```java
@RestController
public class UserController {
    
    @PostMapping("/users/query")
    public Response<Pagination<UserDTO>> queryUsers(@RequestBody UserQuery query) {
        // 1. 参数验证和默认值设置
        if (query == null) {
            query = new UserQuery();
        }
        query.validateAndSetDefaults();
        
        // 2. 执行查询
        List<User> users = userService.queryUsers(query);
        long total = userService.countUsers(query);
        
        // 3. 转换为DTO
        List<UserDTO> userDTOs = users.stream()
                .map(userConverter::toDTO)
                .collect(Collectors.toList());
        
        // 4. 构建分页结果
        Pagination<UserDTO> result = Pagination.of(userDTOs, total, 
                                                  query.getPageNum(), query.getPageSize());
        
        return Response.success(result);
    }
}
```

### 3. 工具类组合使用

```java
@Service
public class FileUploadService {
    
    public String uploadAvatar(MultipartFile file, Long userId) {
        // 1. 参数验证
        ExceptionUtils.requireNonNull(file, "上传文件不能为空");
        ExceptionUtils.requireNonNull(userId, "用户ID不能为空");
        
        // 2. 文件验证
        ExceptionUtils.requireTrue(FileUtils.isValidImageFile(file), 
                                  "只支持图片格式文件");
        ExceptionUtils.requireTrue(file.getSize() <= 5 * 1024 * 1024, 
                                  "文件大小不能超过5MB");
        
        // 3. 生成文件名
        String extension = FileUtils.getExtension(file.getOriginalFilename());
        String fileName = StringUtils.format("avatar_{}_{}.{}", 
                                           userId, System.currentTimeMillis(), extension);
        
        // 4. 保存文件
        String uploadPath = "/uploads/avatars/" + DateTimeUtils.format(LocalDate.now(), "yyyy/MM/dd");
        String savedPath = FileUtils.saveUploadFile(file, uploadPath, fileName);
        
        // 5. 记录操作日志
        log.info("用户 {} 上传头像成功，文件路径: {}", userId, savedPath);
        
        return savedPath;
    }
}
```

## 🔧 扩展指南

### 1. 自定义工具类

创建自定义工具类时，请遵循以下规范：

```java
/**
 * 自定义工具类示例
 * 
 * @author yourname
 * @since 1.0.0
 */
public final class CustomUtils {
    
    private CustomUtils() {
        // 私有构造函数，防止实例化
    }
    
    /**
     * 工具方法说明
     * 
     * @param param 参数说明
     * @return 返回值说明
     * @throws IllegalArgumentException 参数异常说明
     */
    public static String customMethod(String param) {
        // 1. 参数验证
        ExceptionUtils.requireNonBlank(param, "参数不能为空");
        
        // 2. 业务逻辑
        // ...
        
        return result;
    }
}
```

### 2. 工具类测试

```java
@ExtendWith(MockitoExtension.class)
class CustomUtilsTest {
    
    @Test
    void testCustomMethod_Success() {
        // given
        String input = "test";
        
        // when
        String result = CustomUtils.customMethod(input);
        
        // then
        assertThat(result).isNotNull();
        assertThat(result).isEqualTo("expected");
    }
    
    @Test
    void testCustomMethod_ThrowsException_WhenParamIsNull() {
        // when & then
        assertThatThrownBy(() -> CustomUtils.customMethod(null))
                .isInstanceOf(IllegalArgumentException.class)
                .hasMessage("参数不能为空");
    }
}
```

## 📚 参考资料

- [Apache Commons Lang](https://commons.apache.org/proper/commons-lang/) - 字符串和对象工具
- [Google Guava](https://github.com/google/guava) - 集合和工具类
- [Hutool](https://hutool.cn/) - Java工具包
- [Spring Framework Utilities](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/util/package-summary.html) - Spring工具类